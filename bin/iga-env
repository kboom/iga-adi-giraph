# This is the runner for the solver.
# Use run it like this ./iga-env

#!/usr/bin/env bash

THIS_DIR=`dirname "$THIS"`
IGA_HOME=`cd "$THIS_DIR/.." ; pwd`

# Hadoop properties
HADOOP_PROPERTIES=
while [[ $1 ]] && [[ ${1:0:2} == "-D" ]] ; do
    HADOOP_PROPERTIES="$1 $HADOOP_PROPERTIES"
    shift
done

# Application fat-jar from the distribution
IGA_JAR=`cd "$IGA_HOME/dist/" ; pwd`
shift

if [[ ! -e "$IGA_JAR" ]]; then
  echo "No iga jar found at $IGA_JAR. You might need to issue 'mvn clean package' first"
else
  CLASSPATH=${IGA_JAR}
fi

# add configuration to CLASSPATH
CLASSPATH=${CLASSPATH}:${IGA_HOME}/conf
CLASS=org.apache.giraph.GiraphRunner

# so that filenames w/ spaces are handled correctly in loops below
IFS=
# add release dependencies to CLASSPATH, as it is a fat jar we do not need to add Giraph or any other dependency seperately
for f in ${$IGA_HOME}/dist/*.jar; do
  CLASSPATH=${CLASSPATH}:${f}
done
# restore ordinary behaviour
unset IFS

if [[ "$HADOOP_CONF_DIR" = "" ]] ; then
  HADOOP_CONF_DIR=${HADOOP_HOME}/conf
  echo "No HADOOP_CONF_DIR set, using $HADOOP_HOME/conf "
else
  echo "HADOOP_CONF_DIR=$HADOOP_CONF_DIR"
fi

# Giraph's jars to add to distributed cache via -libjar, which are csv rather than :sv
GIRAPH_JARS=`echo ${CLASSPATH}|sed s/:/,/g`
export HADOOP_CLASSPATH=${HADOOP_CLASSPATH}:${CLASSPATH}