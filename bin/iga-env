# This is the runner for the solver.
# Use run it like this ./iga-env

#!/usr/bin/env bash

THIS_DIR=`dirname "$THIS"`
IGA_HOME=`cd "$THIS_DIR/.." ; pwd`
IGA_LIBS=`cd "$IGA_HOME/dist/" ; pwd`

# Hadoop properties
HADOOP_PROPERTIES=
while [[ $1 ]] && [[ ${1:0:2} == "-D" ]] ; do
    HADOOP_PROPERTIES="$1 $HADOOP_PROPERTIES"
    shift
done

# add configuration to CLASSPATH
CLASSPATH=${CLASSPATH}:${IGA_HOME}/conf
CLASS=edu.agh.iga.adi.giraph.IgaSolverTool

# so that filenames w/ spaces are handled correctly in loops below
IFS=
# add release dependencies to CLASSPATH, as it is a fat jar we do not need to add Giraph or any other dependency seperately
for f in ${IGA_LIBS}/*.jar; do
  CLASSPATH=${CLASSPATH}:${f}
  if [[ -e "$f" ]]; then
	JAR=${f}
	break
  fi
done
# restore ordinary behaviour
unset IFS

if [[ "$JAR" = "" ]] ; then
  echo "Can't find Giraph jar. Did you package the project?"
  exit 1
fi

if [[ "$HADOOP_CONF_DIR" = "" ]] ; then
  HADOOP_CONF_DIR=${HADOOP_HOME}/etc/hadoop
  echo "No HADOOP_CONF_DIR set, using $HADOOP_HOME/etc/hadoop"
else
  echo "HADOOP_CONF_DIR=$HADOOP_CONF_DIR"
fi

# Giraph's jars to add to distributed cache via -libjar, which are csv rather than :sv
GIRAPH_JARS=`echo ${CLASSPATH}|sed s/:/,/g`
export HADOOP_CLASSPATH=${HADOOP_CLASSPATH}:${CLASSPATH}